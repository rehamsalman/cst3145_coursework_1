<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coursework 1</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <script src="activities.js"></script>
</head>
<body>
    <main  id="app">
        <header>
            <h1>After School Activities Catalog</h1>
            <button v-on:click="showCheckout" :disabled="canViewCart">
                {{cartItemCount}}
                <span class="fas fa-cart-plus"></span> Go To Cart
            </button>
        </header>
        <div style="display: grid; grid-template-columns: 1fr 2fr;">
            <div style="display:inline-block">
                <h2>Sort By:</h2>
                <input name="attribute" value="title" type="radio"><label>Title</label><br>
                <input name="attribute" value="price" type="radio"> <label>Price</label><br>
                <input name="attribute" value="location" type="radio"><label>Location</label><br>
                <input name="attribute" value="spaces" type="radio"><label>Spaces</label><br><br>
                <input name="direction" value=1 type="radio" @click="ascending"><label>Ascending</label><br>
                <input name="direction" value=-1 type="radio" @click="descending"><label>Descending</label>
            </div>
            <div style="display: inline-block;" v-if="showActivity">
                <div v-for="activity in activities">
                    <img style="max-height: 15em" v-bind:src="activity.image"/>
                    <h2 v-text="activity.title"></h2>
                    <p>Location: {{activity.location}}</p>
                    <p>Price: {{activity.price}} AED</p>
                    <p>Available spaces: {{activity.spaces-cartCount(activity.id)}}</p>
                    <span>
                    <span v-for="n in activity.rating"><i class="fas fa-star"></i></span>
                    <span v-for="n in 5-activity.rating"><i class="far fa-star"></i></span>
                    </span>
                    <button @click="addToCart(activity)" v-if="canAddToCart(activity)">Add To Cart</button>
                    <button disabled="disabled" v-else>Add To Cart</button>
                    <span v-if="activity.spaces === cartCount(activity.id)">All Out!</span>
                    <span v-else-if="activity.spaces - cartCount(activity.id) < 5">
                    Only {{activity.spaces - cartCount(activity.id)}} left!</span>
                </div>
            </div>
            <div v-else>
                <h2>My Cart</h2>
                <button v-on:click="showCheckout">Go To Products</button>
                <div v-for="item in cart">
                    <img style="max-height: 15em" v-bind:src="item.image"/>
                    <h2 v-text="item.title"></h2>
                    <p>Location: {{item.location}}</p>
                    <p>Price: {{item.price}} AED</p>
                    <span>
                    <span v-for="n in item.rating"><i class="fas fa-star" aria-required="true"></i></span>
                    <span v-for="n in 5-item.rating"><i class="far fa-star" required></i></span>
                    </span>
                    <button @click="removeItem(item,cart.indexOf(item))">remove</button>
                </div>
                <h2>Checkout</h2>
                
            </div>
        </div>
    </main>
</body>
<script>
    new Vue({
        el: "#app",
        data: {
            activities: activities,
            cart: [],
            showActivity: true,
        },
        methods: {
            canAddToCart(activity) {
                return activity.spaces > this.cartCount(activity.id);
            },
            addToCart(activity){
                console.log(activity.title+" was added to the cart!");//for debugging purposes
                this.cart.push(activity);
                activity.spaces-=1;
            },
            removeItem(activity,index){
                console.log("remove function started index: "+index);
                this.cart.splice(index,1);
                activity.spaces+=1;
                console.log(activity.title+" was removed from the cart!");//for debugging purposes
            },
            cartCount(id) {
                let count = 0;
                for (let i = 0; i < this.cart.length; i++) {
                    if (this.cart[i] === id) {
                        count++;
                    }
                }
                return count;
            },
            showCheckout(){
                this.showActivity= !this.showActivity;
            },
            ascending(){
                var attribute=document.querySelector('input[name="attribute"]:checked').value;
                console.log("The attributed being sorted: "+attribute);
                this.activities.sort((a,b)=>(a[attribute] < b[attribute] ? -1 : a[attribute] > b[attribute] ? 1 : 0));
            },
            descending(){
                var attribute=document.querySelector('input[name="attribute"]:checked').value;
                console.log("The attributed being sorted: "+attribute);
                this.activities.sort((a,b)=>(a[attribute] > b[attribute] ? -1 : a[attribute] < b[attribute] ? 1 : 0));
            },
            /*sortedByPriceA(){
                this.activities.sort((a,b)=>((a.price < b.price) ? -1 : ((a.price > b.price) ? 1 : 0)));
            },  
            sortedByPriceD(){
                this.activities.sort((a,b)=>((a.price > b.price) ? -1 : ((a.price < b.price) ? 1 : 0)));
            }, 
            sortedByTitleA(){
                this.activities.sort((a,b)=>((a.title < b.title) ? -1 : ((a.title > b.title) ? 1 : 0)));
            },  
            sortedByTitleD(){
                this.activities.sort((a,b)=>((a.title > b.title) ? -1 : ((a.title < b.title) ? 1 : 0)));
            }, 
            sortedByLocationA(){
                this.activities.sort((a,b)=>((a.location < b.location) ? -1 : ((a.location > b.location) ? 1 : 0)));
            },  
            sortedByLocationD(){
                this.activities.sort((a,b)=>((a.location > b.location) ? -1 : ((a.location < b.location) ? 1 : 0)));
            },
            sortedBySpacesA(){
                this.activities.sort((a,b)=>((a.spaces < b.spaces) ? -1 : ((a.spaces > b.spaces) ? 1 : 0)));
            },  
            sortedBySpacesD(){
                this.activities.sort((a,b)=>((a.spaces > b.spaces) ? -1 : ((a.spaces < b.spaces) ? 1 : 0)));
            },  */
        },
        computed: {
            cartItemCount() {
                return this.cart.length || "";
            },
            canViewCart(){
                return this.cart.length > 0 ? false : true;
            },
            
            
            
        }
        });
</script>
</html>