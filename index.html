<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Coursework 1</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <script src="activities.js"></script>
</head>

<body>
    <main id="app">

        <nav>
            <h1>After School Activities Catalog</h1>
            <button v-on:click="showCheckout" :disabled="canViewCart">
                {{cartItemCount}}
                <span class="fas fa-cart-plus"></span> Go To Cart
            </button>
        </nav>
        <div class="row" v-if="showActivity">
            <div class="sidebar col-sm-2">
                <h2>Sort By:</h2>
                <input name="attribute" value="title" type="radio" @click="sortingByAttr"><label>Title</label><br>
                <input name="attribute" value="price" type="radio" @click="sortingByAttr"> <label>Price</label><br>
                <input name="attribute" value="location" type="radio" @click="sortingByAttr"><label>Location</label><br>
                <input name="attribute" value="spaces" type="radio" @click="sortingByAttr"><label>Spaces</label><br><br>
                <input name="direction" value=1 type="radio" @click="sortingByAttr"><label>Ascending</label><br>
                <input name="direction" value=-1 type="radio" @click="sortingByAttr"><label>Descending</label>
            </div>
            <div class="activities col-sm-8">
                <div class="row " v-for="activity in activities">
                    <div class="card col-sm-4 shadow-sm mt-5 mb-4 ml-5" style="width:300px" height="100px">
                        <img class="card-img-top img-fluid pl-5 pr-5 " v-bind:src="activity.image" alt="Card image"
                            style="width:100%">
                        <div class="card-body">
                            <h3 class="card-title text center">{{activity.title}}</h3>
                            <p class="card-text">Price : {{activity.price}}</p>
                            <p class="card-text"> Location: {{activity.location}}</p>
                            <p class="card-text"> Stock : {{activity.spaces}}</p>
                            <p class="card-text"> {{activity.spaces-cartCount(activity.id)}} Items left in stock!
                            </p>
                            <span>
                                <span v-for="n in activity.rating"><i class="fas fa-star"></i></span>
                                <span v-for="n in 5-activity.rating"><i class="far fa-star"></i></span>
                            </span>
                            <button class="btn btn-primary" @click="addToCart(activity)" v-if="canAddToCart(activity)">Add To Cart</button>
                            <button class="btn btn-primary" disabled="disabled" v-else>Add To Cart</button>
                            <span v-if="activity.spaces === cartCount(activity.id)">All Out!</span>
                            <span v-else-if="activity.spaces - cartCount(activity.id) < 5">
                                Only {{activity.spaces - cartCount(activity.id)}} left!</span>
                        </div>
                    </div>
                </div>
                <!--div class="row" v-for="activity in activities">
                    <img class="col-md-4" style="max-height: 15em" v-bind:src="activity.image" />
                    <div class="col-md-8">
                        <h2 v-text="activity.title"></h2>
                        <p>Location: {{activity.location}}</p>
                        <p>Price: {{activity.price}} AED</p>
                        <p>Available spaces: {{activity.spaces-cartCount(activity.id)}}</p>
                        <span>
                            <span v-for="n in activity.rating"><i class="fas fa-star"></i></span>
                            <span v-for="n in 5-activity.rating"><i class="far fa-star"></i></span>
                        </span>
                        <button @click="addToCart(activity)" v-if="canAddToCart(activity)">Add To Cart</button>
                        <button disabled="disabled" v-else>Add To Cart</button>
                        <span v-if="activity.spaces === cartCount(activity.id)">All Out!</span>
                        <span v-else-if="activity.spaces - cartCount(activity.id) < 5">
                            Only {{activity.spaces - cartCount(activity.id)}} left!</span>
                    </div>
                </div-->
            </div>
        </div>
        <div v-else>
            <h2>My Cart</h2>
            <button v-on:click="showCheckout">Go To Products</button>
            <div v-for="item in cart">
                <img style="max-height: 15em" v-bind:src="item.image" />
                <h2 v-text="item.title"></h2>
                <p>Location: {{item.location}}</p>
                <p>Price: {{item.price}} AED</p>
                <span>
                    <span v-for="n in item.rating"><i class="fas fa-star" aria-required="true"></i></span>
                    <span v-for="n in 5-item.rating"><i class="far fa-star" required></i></span>
                </span>
                <button @click="removeItem(item,cart.indexOf(item))">remove</button>
            </div>

            <h2>Checkout</h2>
            <input v-model="order.name" type="text" placeholder="Full name">
            <input v-model.number="order.number" type="number" placeholder="Phone #">
            <button type="submit" v-if="canCheckout" @click="checkout">Checkout</button>
            <button type="submit" v-else disabled>Checkout</button>

            <div>
                Order name: {{numericName}}<br>
                Phone number: {{order.number}}
            </div>
        </div>
    </main>
</body>
<script>
    new Vue({
        el: "#app",
        data: {
            activities: activities,
            cart: [],
            order: {
                name: "",
                number: "",

            },
            showActivity: true,
        },
        methods: {
            canAddToCart(activity) {
                return activity.spaces > this.cartCount(activity.id);
            },
            addToCart(activity) {
                console.log(activity.title + " was added to the cart!");//for debugging purposes
                this.cart.push(activity);
                activity.spaces -= 1;
            },
            removeItem(activity, index) {
                console.log("remove function started index: " + index);
                this.cart.splice(index, 1);
                activity.spaces += 1;
                console.log(activity.title + " was removed from the cart!");//for debugging purposes
            },
            cartCount(id) {
                let count = 0;
                for (let i = 0; i < this.cart.length; i++) {
                    if (this.cart[i] === id) {
                        count++;
                    }
                }
                return count;
            },
            showCheckout() {
                this.showActivity = !this.showActivity;
            },

            checkout() {
                alert("Order Sumbitted!");
                this.cart = [];
                this.order = [];
                for (activity in activities) {
                    activity.spaces = 5;
                }
                this.showCheckout();
            },
            sortingByAttr() {
                var attribute = document.querySelector('input[name="attribute"]:checked').value;
                var dir = document.querySelector('input[name="direction"]:checked');
                if (attribute != null && dir != null) {
                    console.log("The attributed being sorted: " + attribute + " Direction: " + dir.value);
                    if (dir.value == 1) {
                        this.activities.sort((a, b) => (a[attribute] < b[attribute] ? -1 : a[attribute] > b[attribute] ? 1 : 0));
                    }
                    else if (dir.value == -1) {
                        this.activities.sort((a, b) => (a[attribute] > b[attribute] ? -1 : a[attribute] < b[attribute] ? 1 : 0));
                    }
                }
                else {
                    this.activities.sort((a, b) => (a[attribute] < b[attribute] ? -1 : a[attribute] > b[attribute] ? 1 : 0));
                }
            }
        },
        computed: {
            cartItemCount() {
                return this.cart.length || "";
            },
            canViewCart() {
                return this.cart.length > 0 ? false : true;
            },
            canCheckout() {
                if (this.numericName == false) {
                    if (this.order.number != "") {
                        return true;
                    }
                    else {
                        return false;
                    }
                }
                else if (this.numericName == true) {
                    return false;
                }
            },
            numericName() {
                console.log(/\d/.test(this.order.name));
                return /\d/.test(this.order.name);
                // console.log(this.order.name.replace(/[0-9]/g, ''));
                //return this.order.name.replace(/[0-9]/g, '');
            }
        }
    });
</script>

</html>